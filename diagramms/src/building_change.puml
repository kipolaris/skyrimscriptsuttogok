@startuml building_change

title Szobamanipuláció

Participant "g : GameEngine" as g
Participant "b: Building AI" as ai
Participant "roomToChangeDoors : Room" as sz

participant "r1 : Room" as sz1
Participant "r2 : Room" as sz2
participant "splittable : Room" as split
Participant "mergedRoom : Room" as sz3

g->ai ++: initiateChange()
opt ajtó manipuláció [GameEngine.Rooms.size()>=1]
    ai->sz ++: requestDoorinfo()
    note right: Szükséges, hogy tudjuk, milyen állapotból indulunk.
    return doors : ArrayList<Door>

    ai->>ai : randomizeFinalState()
    note right: random meghatározza, hogy a megadott ajtók \n végül milyenek legyenek (pl. egyirányúak, tűnjenek el, stb.)

    ai->sz ++: setDoors(doors : ArrayList<Door>)
    return

opt szoba osztódás [GameEngine.Rooms.size()>=1]

    ai->ai ++: splitRoom(splittable)
    ai->>"aftersplit1 : Room" **: create
    ai->g ++: addRoom(aftersplit1)
    return
    ai->>"aftersplit2 : Room" **: create
    ai->g ++: addRoom(aftersplit2)
    return

    ai->g ++: removeRoom(splittable)
    return

    ai->>split !!: delete
    return

end

opt szoba egyesítés [GameEngine.Rooms.size()>=2]

    ai->g ++: getRooms()
    return rooms : ArrayList<Room>

    ai->>ai : chooseTwoRooms()
    ai->>ai ++: mergeRooms(Room, Room)

    ai->g ++: addRoom(Room)
    g->>sz3 **: create
    g-->ai
    deactivate g
    deactivate ai

    ai->g ++: removeRoom(Room)
    g->>sz1 !!: delete
    g-->ai
    deactivate g
    ai->g ++: removeRoom(Room)
    g->>sz2 !!: delete
    g-->ai
    deactivate g

end
ai-->g --:

@enduml